!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t||self).SwupFormsPlugin=e()}(this,function(){function t(){return t=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},t.apply(this,arguments)}const e=t=>String(t).split(".").map(t=>String(parseInt(t||"0",10))).concat(["0","0"]).slice(0,3).join(".");class r{constructor(){this.isSwupPlugin=!0,this.swup=void 0,this.version=void 0,this.requires={},this.handlersToUnregister=[]}mount(){}unmount(){this.handlersToUnregister.forEach(t=>t()),this.handlersToUnregister=[]}_beforeMount(){if(!this.name)throw new Error("You must define a name of plugin when creating a class.")}_afterUnmount(){}_checkRequirements(){return"object"!=typeof this.requires||Object.entries(this.requires).forEach(([t,r])=>{if(!function(t,r,n){const o=function(t,e){var r;if("swup"===t)return null!=(r=e.version)?r:"";{var n;const r=e.findPlugin(t);return null!=(n=null==r?void 0:r.version)?n:""}}(t,n);return!!o&&((t,r)=>r.every(r=>{const[,n,o]=r.match(/^([\D]+)?(.*)$/)||[];var s,i;return((t,e)=>{const r={"":t=>0===t,">":t=>t>0,">=":t=>t>=0,"<":t=>t<0,"<=":t=>t<=0};return(r[e]||r[""])(t)})((i=o,s=e(s=t),i=e(i),s.localeCompare(i,void 0,{numeric:!0})),n||">=")}))(o,r)}(t,r=Array.isArray(r)?r:[r],this.swup)){const e=`${t} ${r.join(", ")}`;throw new Error(`Plugin version mismatch: ${this.name} requires ${e}`)}}),!0}on(t,e,r={}){var n;e=!(n=e).name.startsWith("bound ")||n.hasOwnProperty("prototype")?e.bind(this):e;const o=this.swup.hooks.on(t,e,r);return this.handlersToUnregister.push(o),o}once(e,r,n={}){return this.on(e,r,t({},n,{once:!0}))}before(e,r,n={}){return this.on(e,r,t({},n,{before:!0}))}replace(e,r,n={}){return this.on(e,r,t({},n,{replace:!0}))}off(t,e){return this.swup.hooks.off(t,e)}}const n=({hash:t}={})=>window.location.pathname+window.location.search+(t?window.location.hash:"");class o extends URL{constructor(t,e=document.baseURI){super(t.toString(),e),Object.setPrototypeOf(this,o.prototype)}get url(){return this.pathname+this.search}static fromElement(t){const e=t.getAttribute("href")||t.getAttribute("xlink:href")||"";return new o(e)}static fromUrl(t){return new o(t)}}function s(t,e,r){let{stripEmptyParams:n=!1}=void 0===r?{}:r;const s=i("method",t,e),a=i("enctype",t,e),u="multipart/form-data"===a,c=i("target",t,e,""),{origin:h,href:l}=o.fromUrl(i("action",t,e)),m=new FormData(t,e);let f,p;if("POST"===s&&(f=u?m:new URLSearchParams(m)),"GET"===s){const t=n?function(t){const e=new FormData;for(const[r,n]of Array.from(t.entries()))""!==n&&e.append(r,n);return e}(m):m;p=function(t,e){const[r,n]=[...t.split(/(?=#)/),""],o=r.split("?")[0],s=new URLSearchParams(e).toString();return s?`${o}?${s}${n}`:o+n}(l,t)}else p=l;const{url:d,hash:b}=o.fromUrl(p);return{origin:h,action:l,href:p,url:d,hash:b,method:s,target:c,data:m,body:f,encoding:a}}function i(t,e,r,o){return function(t,e){switch(t){case"action":return e??n();case"method":return(e||"get").toUpperCase();case"enctype":return(e||"application/x-www-form-urlencoded").toLowerCase();default:return e??null}}(t,r?.getAttribute(`form${t}`)??e.getAttribute(t)??o)}return class extends r{constructor(t){void 0===t&&(t={}),super(),this.name="SwupFormsPlugin",this.requires={swup:">=4"},this.defaults={formSelector:"form[data-swup-form]",inlineFormSelector:"form[data-swup-inline-form]",stripEmptyParams:!1},this.options=void 0,this.specialKeys=void 0,this.formSubmitDelegate=void 0,this.prepareInlineForms=t=>{const{el:e}=t.trigger;if(!e?.matches(this.options.inlineFormSelector))return;if(!e.id)return void console.error("[@swup/forms-plugin] inline forms must have an id attribute:",e);const r=`#${e.id}`;t.containers=[r],t.animation.scope="containers",t.animation.selector=r,t.scroll.target=r;const n=t.a11y;"object"==typeof n&&(n.focus=r)},this.options={...this.defaults,...t},this.specialKeys=function(t){let e={};function r(){e={}}function n(r){let{key:n}=r;t.includes(n)&&(e[n]=!0)}function o(r){let{key:n}=r;t.includes(n)&&(e[n]=!1)}function s(){r()}return{watch:function(){document.addEventListener("keydown",n),document.addEventListener("keyup",o),window.addEventListener("blur",s)},unwatch:function(){document.removeEventListener("keydown",n),document.removeEventListener("keyup",o),document.removeEventListener("blur",s),r()},get pressed(){return Object.values(e).filter(Boolean).length>0}}}(["Meta","Control","Shift"]),this.beforeFormSubmit=this.beforeFormSubmit.bind(this)}mount(){this.swup.hooks.create("form:submit"),this.swup.hooks.create("form:submit:newtab"),this.specialKeys.watch(),this.formSubmitDelegate=this.swup.delegateEvent(this.options.formSelector,"submit",this.beforeFormSubmit,{capture:!0}),this.on("visit:start",this.prepareInlineForms,{priority:1})}unmount(){this.formSubmitDelegate?.destroy(),this.specialKeys.unwatch()}beforeFormSubmit(t){const e=this.swup,{delegateTarget:r,submitter:n}=t,{href:o,url:i,hash:a,target:u}=s(r,n),c=this.specialKeys.pressed,h="_blank"===u,l=c||h,m=e.createVisit({to:i,hash:a,el:r,event:t});if(l||!e.shouldIgnoreVisit(o,{el:r,event:t}))if(h)e.hooks.callSync("form:submit:newtab",m,{el:r,event:t});else if(c){e.hooks.callSync("form:submit:newtab",m,{el:r,event:t});const n=function(t){const e=t.getAttribute("target")||"";return t.setAttribute("target","_blank"),()=>{e?t.setAttribute("target",e):t.removeAttribute("target")}}(r);r.addEventListener("submit",()=>setTimeout(n),{once:!0})}else e.hooks.callSync("form:submit",m,{el:r,event:t},()=>{this.submitForm(t)})}submitForm(t){const{delegateTarget:e,submitter:r}=t,{stripEmptyParams:n}=this.options,{href:o,method:i,body:a}=s(e,r,{stripEmptyParams:n});["GET","POST"].includes(i)?(t.preventDefault(),this.swup.navigate(o,{method:i,body:a,cache:{read:!1,write:!0}},{el:e,event:t})):console.warn(`Unsupported form method: ${i}`)}}});
//# sourceMappingURL=index.umd.js.map
