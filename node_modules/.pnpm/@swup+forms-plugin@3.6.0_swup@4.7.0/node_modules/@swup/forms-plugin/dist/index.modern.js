import t from"@swup/plugin";import{Location as e,getCurrentUrl as r}from"swup";function n(){return n=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},n.apply(this,arguments)}function o(t,r,{stripEmptyParams:n=!1}={}){const o=i("method",t,r),s=i("enctype",t,r),a="multipart/form-data"===s,u=i("target",t,r,""),{origin:l,href:c}=e.fromUrl(i("action",t,r)),m=new FormData(t,r);let h,f;if("POST"===o&&(h=a?m:new URLSearchParams(m)),"GET"===o){const t=n?function(t){const e=new FormData;for(const[r,n]of Array.from(t.entries()))""!==n&&e.append(r,n);return e}(m):m;f=function(t,e){const[r,n]=[...t.split(/(?=#)/),""],o=r.split("?")[0],i=new URLSearchParams(e).toString();return i?`${o}?${i}${n}`:o+n}(c,t)}else f=c;const{url:p,hash:d}=e.fromUrl(f);return{origin:l,action:c,href:f,url:p,hash:d,method:o,target:u,data:m,body:h,encoding:s}}function i(t,e,n,o){var i,s;return function(t,e){switch(t){case"action":return null!=e?e:r();case"method":return(e||"get").toUpperCase();case"enctype":return(e||"application/x-www-form-urlencoded").toLowerCase();default:return null!=e?e:null}}(t,null!=(i=null!=(s=null==n?void 0:n.getAttribute(`form${t}`))?s:e.getAttribute(t))?i:o)}class s extends t{constructor(t={}){super(),this.name="SwupFormsPlugin",this.requires={swup:">=4"},this.defaults={formSelector:"form[data-swup-form]",inlineFormSelector:"form[data-swup-inline-form]",stripEmptyParams:!1},this.options=void 0,this.specialKeys=void 0,this.formSubmitDelegate=void 0,this.prepareInlineForms=t=>{const{el:e}=t.trigger;if(null==e||!e.matches(this.options.inlineFormSelector))return;if(!e.id)return void console.error("[@swup/forms-plugin] inline forms must have an id attribute:",e);const r=`#${e.id}`;t.containers=[r],t.animation.scope="containers",t.animation.selector=r,t.scroll.target=r;const n=t.a11y;"object"==typeof n&&(n.focus=r)},this.options=n({},this.defaults,t),this.specialKeys=function(t){let e={};function r(){e={}}function n({key:r}){t.includes(r)&&(e[r]=!0)}function o({key:r}){t.includes(r)&&(e[r]=!1)}function i(){r()}return{watch:function(){document.addEventListener("keydown",n),document.addEventListener("keyup",o),window.addEventListener("blur",i)},unwatch:function(){document.removeEventListener("keydown",n),document.removeEventListener("keyup",o),document.removeEventListener("blur",i),r()},get pressed(){return Object.values(e).filter(Boolean).length>0}}}(["Meta","Control","Shift"]),this.beforeFormSubmit=this.beforeFormSubmit.bind(this)}mount(){this.swup.hooks.create("form:submit"),this.swup.hooks.create("form:submit:newtab"),this.specialKeys.watch(),this.formSubmitDelegate=this.swup.delegateEvent(this.options.formSelector,"submit",this.beforeFormSubmit,{capture:!0}),this.on("visit:start",this.prepareInlineForms,{priority:1})}unmount(){var t;null==(t=this.formSubmitDelegate)||t.destroy(),this.specialKeys.unwatch()}beforeFormSubmit(t){const e=this.swup,{delegateTarget:r,submitter:n}=t,{href:i,url:s,hash:a,target:u}=o(r,n),l=this.specialKeys.pressed,c="_blank"===u,m=l||c,h=e.createVisit({to:s,hash:a,el:r,event:t});if(m||!e.shouldIgnoreVisit(i,{el:r,event:t}))if(c)e.hooks.callSync("form:submit:newtab",h,{el:r,event:t});else if(l){e.hooks.callSync("form:submit:newtab",h,{el:r,event:t});const n=function(t){const e=t.getAttribute("target")||"";return t.setAttribute("target","_blank"),()=>{e?t.setAttribute("target",e):t.removeAttribute("target")}}(r);r.addEventListener("submit",()=>setTimeout(n),{once:!0})}else e.hooks.callSync("form:submit",h,{el:r,event:t},()=>{this.submitForm(t)})}submitForm(t){const{delegateTarget:e,submitter:r}=t,{stripEmptyParams:n}=this.options,{href:i,method:s,body:a}=o(e,r,{stripEmptyParams:n});["GET","POST"].includes(s)?(t.preventDefault(),this.swup.navigate(i,{method:s,body:a,cache:{read:!1,write:!0}},{el:e,event:t})):console.warn(`Unsupported form method: ${s}`)}}export{s as default};
//# sourceMappingURL=index.modern.js.map
