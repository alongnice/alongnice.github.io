{"version":3,"file":"index.umd.js","sources":["../node_modules/@swup/plugin/dist/index.modern.js","../src/ProgressBar.ts","../src/index.ts"],"sourcesContent":["function r(){return r=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t])}return r},r.apply(this,arguments)}const n=r=>String(r).split(\".\").map(r=>String(parseInt(r||\"0\",10))).concat([\"0\",\"0\"]).slice(0,3).join(\".\");class e{constructor(){this.isSwupPlugin=!0,this.swup=void 0,this.version=void 0,this.requires={},this.handlersToUnregister=[]}mount(){}unmount(){this.handlersToUnregister.forEach(r=>r()),this.handlersToUnregister=[]}_beforeMount(){if(!this.name)throw new Error(\"You must define a name of plugin when creating a class.\")}_afterUnmount(){}_checkRequirements(){return\"object\"!=typeof this.requires||Object.entries(this.requires).forEach(([r,e])=>{if(!function(r,e,t){const s=function(r,n){var e;if(\"swup\"===r)return null!=(e=n.version)?e:\"\";{var t;const e=n.findPlugin(r);return null!=(t=null==e?void 0:e.version)?t:\"\"}}(r,t);return!!s&&((r,e)=>e.every(e=>{const[,t,s]=e.match(/^([\\D]+)?(.*)$/)||[];var o,i;return((r,n)=>{const e={\"\":r=>0===r,\">\":r=>r>0,\">=\":r=>r>=0,\"<\":r=>r<0,\"<=\":r=>r<=0};return(e[n]||e[\"\"])(r)})((i=s,o=n(o=r),i=n(i),o.localeCompare(i,void 0,{numeric:!0})),t||\">=\")}))(s,e)}(r,e=Array.isArray(e)?e:[e],this.swup)){const n=`${r} ${e.join(\", \")}`;throw new Error(`Plugin version mismatch: ${this.name} requires ${n}`)}}),!0}on(r,n,e={}){var t;n=!(t=n).name.startsWith(\"bound \")||t.hasOwnProperty(\"prototype\")?n.bind(this):n;const s=this.swup.hooks.on(r,n,e);return this.handlersToUnregister.push(s),s}once(n,e,t={}){return this.on(n,e,r({},t,{once:!0}))}before(n,e,t={}){return this.on(n,e,r({},t,{before:!0}))}replace(n,e,t={}){return this.on(n,e,r({},t,{replace:!0}))}off(r,n){return this.swup.hooks.off(r,n)}}export{e as default};\n//# sourceMappingURL=index.modern.js.map\n","export default class ProgressBar {\n\tvalue: number = 0;\n\tvisible: boolean = false;\n\thiding: boolean = false;\n\n\tclassName: string = 'progress-bar';\n\tstyleAttr: string = 'data-progressbar-styles data-swup-theme';\n\tanimationDuration: number = 300;\n\tminValue: number = 0.1;\n\tinitialValue: number = 0.25;\n\ttrickleValue: number = 0.03;\n\ttrickleInterval?: number;\n\n\tstyleElement: HTMLStyleElement;\n\tprogressElement: HTMLDivElement;\n\n\tconstructor({\n\t\tclassName,\n\t\tstyleAttr,\n\t\tanimationDuration,\n\t\tminValue,\n\t\tinitialValue,\n\t\ttrickleValue\n\t}: {\n\t\tclassName?: string;\n\t\tstyleAttr?: string;\n\t\tanimationDuration?: number;\n\t\tminValue?: number;\n\t\tinitialValue?: number;\n\t\ttrickleValue?: number;\n\t} = {}) {\n\t\tif (className !== undefined) {\n\t\t\tthis.className = String(className);\n\t\t}\n\t\tif (styleAttr !== undefined) {\n\t\t\tthis.styleAttr = String(styleAttr);\n\t\t}\n\t\tif (animationDuration !== undefined) {\n\t\t\tthis.animationDuration = Number(animationDuration);\n\t\t}\n\t\tif (minValue !== undefined) {\n\t\t\tthis.minValue = Number(minValue);\n\t\t}\n\t\tif (initialValue !== undefined) {\n\t\t\tthis.initialValue = Number(initialValue);\n\t\t}\n\t\tif (trickleValue !== undefined) {\n\t\t\tthis.trickleValue = Number(trickleValue);\n\t\t}\n\n\t\tthis.styleElement = this.createStyleElement();\n\t\tthis.progressElement = this.createProgressElement();\n\t}\n\n\tget defaultStyles(): string {\n\t\treturn `\n\t\t.${this.className} {\n\t\t\tposition: fixed;\n\t\t\tdisplay: block;\n\t\t\ttop: 0;\n\t\t\tleft: 0;\n      width: 100%;\n\t\t\theight: 3px;\n\t\t\tbackground-color: black;\n\t\t\tz-index: 9999;\n\t\t\ttransition:\n\t\t\t\ttransform ${this.animationDuration}ms ease-out,\n\t\t\t\topacity ${this.animationDuration / 2}ms ${this.animationDuration / 2}ms ease-in;\n\t  transform: translate3d(0, 0, 0) scaleX(var(--progress, 0));\n      transform-origin: 0;\n\t\t}\n\t`;\n\t}\n\n\tshow(): void {\n\t\tif (!this.visible) {\n\t\t\tthis.visible = true;\n\t\t\tthis.installStyleElement();\n\t\t\tthis.installProgressElement();\n\t\t\tthis.startTrickling();\n\t\t}\n\t}\n\n\thide(): void {\n\t\tif (this.visible && !this.hiding) {\n\t\t\tthis.hiding = true;\n\t\t\tthis.fadeProgressElement(() => {\n\t\t\t\tthis.uninstallProgressElement();\n\t\t\t\tthis.stopTrickling();\n\t\t\t\tthis.visible = false;\n\t\t\t\tthis.hiding = false;\n\t\t\t});\n\t\t}\n\t}\n\n\tsetValue(value: number): void {\n\t\tthis.value = Math.min(1, Math.max(this.minValue, value));\n\t\tthis.refresh();\n\t}\n\n\tprivate installStyleElement(): void {\n\t\tdocument.head.prepend(this.styleElement);\n\t}\n\n\tprivate installProgressElement(): void {\n\t\tthis.progressElement.style.setProperty('--progress', String(0));\n\t\tthis.progressElement.style.opacity = '1';\n\t\tdocument.body.prepend(this.progressElement);\n\t\tthis.progressElement.scrollTop = 0; // Force reflow to ensure the initial style takes effect\n\t\tthis.setValue(Math.random() * this.initialValue);\n\t}\n\n\tprivate fadeProgressElement(callback: () => void): void {\n\t\tthis.progressElement.style.opacity = '0';\n\t\tsetTimeout(callback, this.animationDuration * 1.5);\n\t}\n\n\tprivate uninstallProgressElement(): void {\n\t\tthis.progressElement.remove();\n\t}\n\n\tprivate startTrickling(): void {\n\t\tif (!this.trickleInterval) {\n\t\t\tthis.trickleInterval = window.setInterval(this.trickle, this.animationDuration);\n\t\t}\n\t}\n\n\tprivate stopTrickling(): void {\n\t\twindow.clearInterval(this.trickleInterval);\n\t\tdelete this.trickleInterval;\n\t}\n\n\tprivate trickle = (): void => {\n\t\tconst advance = Math.random() * this.trickleValue;\n\t\tthis.setValue(this.value + advance);\n\t};\n\n\tprivate refresh(): void {\n\t\trequestAnimationFrame(() => {\n\t\t\tthis.progressElement.style.setProperty('--progress', String(this.value));\n\t\t});\n\t}\n\n\tprivate createStyleElement(): HTMLStyleElement {\n\t\tconst element = document.createElement('style');\n\t\tthis.styleAttr.split(' ').forEach((attr) => element.setAttribute(attr, ''));\n\t\telement.textContent = this.defaultStyles;\n\t\treturn element;\n\t}\n\n\tprivate createProgressElement(): HTMLDivElement {\n\t\tconst element = document.createElement('div');\n\t\telement.className = this.className;\n\t\telement.setAttribute('aria-hidden', 'true');\n\t\treturn element;\n\t}\n}\n","import Plugin from '@swup/plugin';\nimport ProgressBar from './ProgressBar.js';\n\ntype Options = {\n\tclassName: string;\n\tdelay: number;\n\ttransition: number;\n\tminValue: number;\n\tinitialValue: number;\n\tfinishAnimation: boolean;\n};\n\nexport default class SwupProgressPlugin extends Plugin {\n\tname = 'SwupProgressPlugin';\n\n\tdefaults: Options = {\n\t\tclassName: 'swup-progress-bar',\n\t\tdelay: 300,\n\t\ttransition: 300,\n\t\tminValue: 0.1,\n\t\tinitialValue: 0.25,\n\t\tfinishAnimation: true\n\t};\n\toptions: Options;\n\n\tprogressBar: ProgressBar;\n\tshowProgressBarTimeout?: number;\n\thideProgressBarTimeout?: number;\n\n\tconstructor(options: Partial<Options> = {}) {\n\t\tsuper();\n\t\tthis.options = { ...this.defaults, ...options };\n\t\tconst { className, minValue, initialValue, transition: animationDuration } = this.options;\n\t\tthis.progressBar = new ProgressBar({\n\t\t\tclassName,\n\t\t\tminValue,\n\t\t\tinitialValue,\n\t\t\tanimationDuration\n\t\t});\n\t}\n\n\tmount() {\n\t\tthis.on('visit:start', this.startShowingProgress);\n\t\tthis.on('page:view', this.stopShowingProgress);\n\t}\n\n\tstartShowingProgress() {\n\t\tthis.progressBar.setValue(0);\n\t\tthis.showProgressBarAfterDelay();\n\t}\n\n\tstopShowingProgress() {\n\t\tthis.progressBar.setValue(1);\n\t\tif (this.options.finishAnimation) {\n\t\t\tthis.finishAnimationAndHideProgressBar();\n\t\t} else {\n\t\t\tthis.hideProgressBar();\n\t\t}\n\t}\n\n\tshowProgressBar() {\n\t\tthis.cancelHideProgressBarTimeout();\n\t\tthis.progressBar.show();\n\t}\n\n\tshowProgressBarAfterDelay() {\n\t\tthis.cancelShowProgressBarTimeout();\n\t\tthis.cancelHideProgressBarTimeout();\n\t\tthis.showProgressBarTimeout = window.setTimeout(\n\t\t\tthis.showProgressBar.bind(this),\n\t\t\tthis.options.delay\n\t\t);\n\t}\n\n\thideProgressBar() {\n\t\tthis.cancelShowProgressBarTimeout();\n\t\tthis.progressBar.hide();\n\t}\n\n\tfinishAnimationAndHideProgressBar() {\n\t\tthis.cancelShowProgressBarTimeout();\n\t\tthis.hideProgressBarTimeout = window.setTimeout(\n\t\t\tthis.hideProgressBar.bind(this),\n\t\t\tthis.options.transition\n\t\t);\n\t}\n\n\tcancelShowProgressBarTimeout() {\n\t\twindow.clearTimeout(this.showProgressBarTimeout);\n\t\tdelete this.showProgressBarTimeout;\n\t}\n\n\tcancelHideProgressBarTimeout() {\n\t\twindow.clearTimeout(this.hideProgressBarTimeout);\n\t\tdelete this.hideProgressBarTimeout;\n\t}\n}\n"],"names":["n","r","String","split","map","parseInt","concat","slice","join","e","every","t","s","match","o","i","localeCompare","numeric","ProgressBar","constructor","_temp","className","styleAttr","animationDuration","minValue","initialValue","trickleValue","this","value","visible","hiding","trickleInterval","styleElement","progressElement","trickle","advance","Math","random","setValue","undefined","Number","createStyleElement","createProgressElement","defaultStyles","show","installStyleElement","installProgressElement","startTrickling","hide","fadeProgressElement","uninstallProgressElement","stopTrickling","min","max","refresh","document","head","prepend","style","setProperty","opacity","body","scrollTop","callback","setTimeout","remove","window","setInterval","clearInterval","requestAnimationFrame","element","createElement","forEach","attr","setAttribute","textContent","Plugin","options","super","name","defaults","delay","transition","finishAnimation","progressBar","showProgressBarTimeout","hideProgressBarTimeout","mount","on","startShowingProgress","stopShowingProgress","showProgressBarAfterDelay","finishAnimationAndHideProgressBar","hideProgressBar","showProgressBar","cancelHideProgressBarTimeout","cancelShowProgressBarTimeout","bind","clearTimeout"],"mappings":"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"}