import{Location as e,nextTick as t}from"swup";import n from"@swup/plugin";import i from"on-demand-live-region";import"focus-options-polyfill";function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},o.apply(this,arguments)}class s extends n{constructor(e={}){var t,n;super(),this.name="SwupA11yPlugin",this.requires={swup:">=4"},this.defaults={contentSelector:"main",headingSelector:"h1, h2, [role=heading]",respectReducedMotion:!1,autofocus:!1,announcements:{visit:"Navigated to: {title}",url:"New page at {url}"}},this.options=void 0,this.liveRegion=void 0,this.announce=e=>{this.liveRegion.say(e)},e.announcements=o({},this.defaults.announcements,{visit:null!=(t=e.announcementTemplate)?t:String(this.defaults.announcements.visit),url:null!=(n=e.urlTemplate)?n:String(this.defaults.announcements.url)},e.announcements),this.options=o({},this.defaults,e),this.liveRegion=new i}mount(){this.swup.hooks.create("content:announce"),this.swup.hooks.create("content:focus"),this.before("visit:start",this.prepareVisit),this.on("visit:start",this.markAsBusy),this.on("visit:end",this.unmarkAsBusy),this.on("content:replace",this.prepareAnnouncement),this.on("content:replace",this.handleNewPageContent),this.options.respectReducedMotion&&(this.before("visit:start",this.disableTransitionAnimations),this.before("visit:start",this.disableScrollAnimations),this.before("link:self",this.disableScrollAnimations),this.before("link:anchor",this.disableScrollAnimations)),this.swup.announce=this.announce}unmount(){this.swup.announce=void 0}markAsBusy(){document.documentElement.setAttribute("aria-busy","true")}unmarkAsBusy(){document.documentElement.removeAttribute("aria-busy")}prepareVisit(e){e.a11y={announce:void 0,focus:this.options.contentSelector}}prepareAnnouncement(t){if(void 0!==t.a11y.announce)return;const{contentSelector:n,headingSelector:i,announcements:o}=this.options,{href:s,url:a,pathname:r}=e.fromUrl(window.location.href),u=o[document.documentElement.lang||"*"]||o["*"]||o;if("object"!=typeof u)return;const c=document.querySelector(`${n} ${i}`);let l=(null==c?void 0:c.getAttribute("aria-label"))||(null==c?void 0:c.textContent);l=l||document.title||this.parseTemplate(u.url,{href:s,url:a,path:r});const h=this.parseTemplate(u.visit,{title:l,href:s,url:a,path:r});t.a11y.announce=h}parseTemplate(e,t){return Object.keys(t).reduce((e,n)=>e.replace(`{${n}}`,t[n]||""),e||"")}handleNewPageContent(){var e=this;t().then(async function(){e.swup.hooks.call("content:announce",void 0,void 0,t=>{e.announcePageName(t)}),e.swup.hooks.call("content:focus",void 0,void 0,t=>{e.focusPageContent(t)})})}announcePageName(e){e.a11y.announce&&this.liveRegion.say(e.a11y.announce)}async focusPageContent(e){if(!e.a11y.focus)return;if(this.options.autofocus){const t=this.getAutofocusElement();if(t&&t!==document.activeElement)return void this.swup.hooks.once("visit:end",n=>{n.id===e.id&&t.focus()})}const t=document.querySelector(e.a11y.focus);t instanceof HTMLElement&&(this.needsTabindex(t)&&t.setAttribute("tabindex","-1"),t.focus({preventScroll:!0}))}getAutofocusElement(){const e=document.querySelector("body [autofocus]");if(e&&!e.closest('inert, [aria-disabled], [aria-hidden="true"]'))return e}disableTransitionAnimations(e){e.animation.animate=e.animation.animate&&this.shouldAnimate()}disableScrollAnimations(e){e.scroll.animate=e.scroll.animate&&this.shouldAnimate()}shouldAnimate(){return!window.matchMedia("(prefers-reduced-motion: reduce)").matches}needsTabindex(e){return!e.matches("a, button, input, textarea, select, details, [tabindex]")}}export{s as default};
//# sourceMappingURL=index.modern.js.map
