!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e||self).SwupA11yPlugin=t()}(this,function(){class e extends URL{constructor(t,n=document.baseURI){super(t.toString(),n),Object.setPrototypeOf(this,e.prototype)}get url(){return this.pathname+this.search}static fromElement(t){const n=t.getAttribute("href")||t.getAttribute("xlink:href")||"";return new e(n)}static fromUrl(t){return new e(t)}}function t(){return t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},t.apply(this,arguments)}const n=e=>String(e).split(".").map(e=>String(parseInt(e||"0",10))).concat(["0","0"]).slice(0,3).join(".");class i{constructor(){this.isSwupPlugin=!0,this.swup=void 0,this.version=void 0,this.requires={},this.handlersToUnregister=[]}mount(){}unmount(){this.handlersToUnregister.forEach(e=>e()),this.handlersToUnregister=[]}_beforeMount(){if(!this.name)throw new Error("You must define a name of plugin when creating a class.")}_afterUnmount(){}_checkRequirements(){return"object"!=typeof this.requires||Object.entries(this.requires).forEach(([e,t])=>{if(!function(e,t,i){const o=function(e,t){var n;if("swup"===e)return null!=(n=t.version)?n:"";{var i;const n=t.findPlugin(e);return null!=(i=null==n?void 0:n.version)?i:""}}(e,i);return!!o&&((e,t)=>t.every(t=>{const[,i,o]=t.match(/^([\D]+)?(.*)$/)||[];var s,r;return((e,t)=>{const n={"":e=>0===e,">":e=>e>0,">=":e=>e>=0,"<":e=>e<0,"<=":e=>e<=0};return(n[t]||n[""])(e)})((r=o,s=n(s=e),r=n(r),s.localeCompare(r,void 0,{numeric:!0})),i||">=")}))(o,t)}(e,t=Array.isArray(t)?t:[t],this.swup)){const n=`${e} ${t.join(", ")}`;throw new Error(`Plugin version mismatch: ${this.name} requires ${n}`)}}),!0}on(e,t,n={}){var i;t=!(i=t).name.startsWith("bound ")||i.hasOwnProperty("prototype")?t.bind(this):t;const o=this.swup.hooks.on(e,t,n);return this.handlersToUnregister.push(o),o}once(e,n,i={}){return this.on(e,n,t({},i,{once:!0}))}before(e,n,i={}){return this.on(e,n,t({},i,{before:!0}))}replace(e,n,i={}){return this.on(e,n,t({},i,{replace:!0}))}off(e,t){return this.swup.hooks.off(e,t)}}var o=function(e){var t={exports:{}};return function(e){!function(t){function n(e){for(var t in e=e||{},this.settings={level:"polite",parent:"body",idPrefix:"live-region-",delay:0},e)e.hasOwnProperty(t)&&(this.settings[t]=e[t]);this.settings.parent=document.querySelector(this.settings.parent)}n.prototype.say=function(e,t){var n=this.settings.parent.querySelector('[id^="'+this.settings.idPrefix+'"]')||!1;n&&this.settings.parent.removeChild(n),t=t||this.settings.delay,this.currentRegion=document.createElement("span"),this.currentRegion.id=this.settings.idPrefix+Math.floor(1e4*Math.random());var i="assertive"!==this.settings.level?"status":"alert";return this.currentRegion.setAttribute("aria-live",this.settings.level),this.currentRegion.setAttribute("role",i),this.currentRegion.setAttribute("style","clip: rect(1px, 1px, 1px, 1px); height: 1px; overflow: hidden; position: absolute; white-space: nowrap; width: 1px"),this.settings.parent.appendChild(this.currentRegion),window.setTimeout(function(){this.currentRegion.textContent=e}.bind(this),t),this},e.exports=n}()}(t),t.exports}();return function(){if("undefined"!=typeof window&&"undefined"!=typeof document&&"undefined"!=typeof HTMLElement){var e=!1;try{var t=document.createElement("div");t.addEventListener("focus",function(e){e.preventDefault(),e.stopPropagation()},!0),t.focus(Object.defineProperty({},"preventScroll",{get:function(){if(navigator&&void 0!==navigator.userAgent&&navigator.userAgent&&navigator.userAgent.match(/Edge\/1[7-8]/))return e=!1;e=!0}}))}catch(e){}if(void 0===HTMLElement.prototype.nativeFocus&&!e){HTMLElement.prototype.nativeFocus=HTMLElement.prototype.focus;var n=function(e){for(var t=0;t<e.length;t++)e[t][0].scrollTop=e[t][1],e[t][0].scrollLeft=e[t][2];e=[]};HTMLElement.prototype.focus=function(e){if(e&&e.preventScroll){var t=function(e){for(var t=e.parentNode,n=[],i=document.scrollingElement||document.documentElement;t&&t!==i;)(t.offsetHeight<t.scrollHeight||t.offsetWidth<t.scrollWidth)&&n.push([t,t.scrollTop,t.scrollLeft]),t=t.parentNode;return n.push([t=i,t.scrollTop,t.scrollLeft]),n}(this);if("function"==typeof setTimeout){var i=this;setTimeout(function(){i.nativeFocus(),n(t)},0)}else this.nativeFocus(),n(t)}else this.nativeFocus()}}}}(),class extends i{constructor(e){void 0===e&&(e={}),super(),this.name="SwupA11yPlugin",this.requires={swup:">=4"},this.defaults={contentSelector:"main",headingSelector:"h1, h2, [role=heading]",respectReducedMotion:!1,autofocus:!1,announcements:{visit:"Navigated to: {title}",url:"New page at {url}"}},this.options=void 0,this.liveRegion=void 0,this.announce=e=>{this.liveRegion.say(e)},e.announcements={...this.defaults.announcements,visit:e.announcementTemplate??String(this.defaults.announcements.visit),url:e.urlTemplate??String(this.defaults.announcements.url),...e.announcements},this.options={...this.defaults,...e},this.liveRegion=new o}mount(){this.swup.hooks.create("content:announce"),this.swup.hooks.create("content:focus"),this.before("visit:start",this.prepareVisit),this.on("visit:start",this.markAsBusy),this.on("visit:end",this.unmarkAsBusy),this.on("content:replace",this.prepareAnnouncement),this.on("content:replace",this.handleNewPageContent),this.options.respectReducedMotion&&(this.before("visit:start",this.disableTransitionAnimations),this.before("visit:start",this.disableScrollAnimations),this.before("link:self",this.disableScrollAnimations),this.before("link:anchor",this.disableScrollAnimations)),this.swup.announce=this.announce}unmount(){this.swup.announce=void 0}markAsBusy(){document.documentElement.setAttribute("aria-busy","true")}unmarkAsBusy(){document.documentElement.removeAttribute("aria-busy")}prepareVisit(e){e.a11y={announce:void 0,focus:this.options.contentSelector}}prepareAnnouncement(t){if(void 0!==t.a11y.announce)return;const{contentSelector:n,headingSelector:i,announcements:o}=this.options,{href:s,url:r,pathname:a}=e.fromUrl(window.location.href),u=o[document.documentElement.lang||"*"]||o["*"]||o;if("object"!=typeof u)return;const c=document.querySelector(`${n} ${i}`);let l=c?.getAttribute("aria-label")||c?.textContent;l=l||document.title||this.parseTemplate(u.url,{href:s,url:r,path:a});const h=this.parseTemplate(u.visit,{title:l,href:s,url:r,path:a});t.a11y.announce=h}parseTemplate(e,t){return Object.keys(t).reduce((e,n)=>e.replace(`{${n}}`,t[n]||""),e||"")}handleNewPageContent(){const e=this;new Promise(e=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{e()})})}).then(function(){try{return e.swup.hooks.call("content:announce",void 0,void 0,t=>{e.announcePageName(t)}),e.swup.hooks.call("content:focus",void 0,void 0,t=>{e.focusPageContent(t)}),Promise.resolve()}catch(e){return Promise.reject(e)}})}announcePageName(e){e.a11y.announce&&this.liveRegion.say(e.a11y.announce)}focusPageContent(e){try{const t=this;if(!e.a11y.focus)return Promise.resolve();if(t.options.autofocus){const n=t.getAutofocusElement();if(n&&n!==document.activeElement)return t.swup.hooks.once("visit:end",t=>{t.id===e.id&&n.focus()}),Promise.resolve()}const n=document.querySelector(e.a11y.focus);return n instanceof HTMLElement&&(t.needsTabindex(n)&&n.setAttribute("tabindex","-1"),n.focus({preventScroll:!0})),Promise.resolve()}catch(e){return Promise.reject(e)}}getAutofocusElement(){const e=document.querySelector("body [autofocus]");if(e&&!e.closest('inert, [aria-disabled], [aria-hidden="true"]'))return e}disableTransitionAnimations(e){e.animation.animate=e.animation.animate&&this.shouldAnimate()}disableScrollAnimations(e){e.scroll.animate=e.scroll.animate&&this.shouldAnimate()}shouldAnimate(){return!window.matchMedia("(prefers-reduced-motion: reduce)").matches}needsTabindex(e){return!e.matches("a, button, input, textarea, select, details, [tabindex]")}}});
//# sourceMappingURL=index.umd.js.map
