import{e as g}from"./index.modern.BC8Oj8jT.js";import{l as y}from"./Swup.DhuoVEBe.js";function h(){return h=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},h.apply(this,arguments)}function p(t,e){return Object.keys(e).reduce(((t,n)=>t.replace(`{${n}}`,e[n]||"")),t||"")}!function(){if(!(typeof window>"u"||typeof document>"u"||typeof HTMLElement>"u")){var t=!1;try{var e=document.createElement("div");e.addEventListener("focus",(function(t){t.preventDefault(),t.stopPropagation()}),!0),e.focus(Object.defineProperty({},"preventScroll",{get:function(){if(navigator&&typeof navigator.userAgent<"u"&&navigator.userAgent&&navigator.userAgent.match(/Edge\/1[7-8]/))return t=!1;t=!0}}))}catch{}if(void 0===HTMLElement.prototype.nativeFocus&&!t){HTMLElement.prototype.nativeFocus=HTMLElement.prototype.focus;var n=function(t){for(var e=0;e<t.length;e++)t[e][0].scrollTop=t[e][1],t[e][0].scrollLeft=t[e][2];t=[]};HTMLElement.prototype.focus=function(t){if(t&&t.preventScroll){var e=function(t){for(var e=t.parentNode,n=[],o=document.scrollingElement||document.documentElement;e&&e!==o;)(e.offsetHeight<e.scrollHeight||e.offsetWidth<e.scrollWidth)&&n.push([e,e.scrollTop,e.scrollLeft]),e=e.parentNode;return e=o,n.push([e,e.scrollTop,e.scrollLeft]),n}(this);if("function"==typeof setTimeout){var o=this;setTimeout((function(){o.nativeFocus(),n(e)}),0)}else this.nativeFocus(),n(e)}else this.nativeFocus()}}}}();class w{constructor(){var t;this.id="swup-announcer",this.style="position:absolute;top:0;left:0;clip:rect(0 0 0 0);clip-path:inset(50%);overflow:hidden;white-space:nowrap;word-wrap:normal;width:1px;height:1px;",this.region=void 0,this.region=null!=(t=this.getRegion())?t:this.createRegion()}getRegion(){return document.getElementById(this.id)}createRegion(){const t=function(t){const e=document.createElement("template");return e.innerHTML=t,e.content.children[0]}(`<p aria-live="assertive" aria-atomic="true" id="${this.id}" style="${this.style}"></p>`);return document.body.appendChild(t),t}announce(t,e=0){return new Promise((n=>{setTimeout((()=>{this.region.textContent===t&&(t=`${t}.`),this.region.textContent="",this.region.textContent=t,n()}),e)}))}}function m(t){let e;if(e="string"==typeof t?document.querySelector(t):t,!(e instanceof HTMLElement))return;const n=e.getAttribute("tabindex");e.setAttribute("tabindex","-1"),e.focus({preventScroll:!0}),null!==n&&e.setAttribute("tabindex",n)}class S extends g{constructor(t={}){super(),this.name="SwupA11yPlugin",this.requires={swup:">=4"},this.defaults={headingSelector:"h1",respectReducedMotion:!0,autofocus:!1,announcements:{visit:"Navigated to: {title}",url:"New page at {url}"}},this.options=void 0,this.announcer=void 0,this.announcementDelay=100,this.rootSelector="body",this.handleAnchorScroll=(t,{hash:e})=>{const n=this.swup.getAnchorElement(e);n instanceof HTMLElement&&m(n)},this.options=h({},this.defaults,t),this.announcer=new w}mount(){this.swup.hooks.create("content:announce"),this.swup.hooks.create("content:focus"),this.before("visit:start",this.prepareVisit),this.on("visit:start",this.markAsBusy),this.on("visit:end",this.unmarkAsBusy),this.on("visit:end",this.focusContent),this.on("visit:end",this.announceContent),this.on("scroll:anchor",this.handleAnchorScroll),this.before("visit:start",this.disableAnimations),this.before("link:self",this.disableAnimations),this.before("link:anchor",this.disableAnimations),this.swup.announce=this.announce.bind(this)}unmount(){this.swup.announce=void 0}async announce(t){await this.announcer.announce(t)}markAsBusy(){document.documentElement.setAttribute("aria-busy","true")}unmarkAsBusy(){document.documentElement.removeAttribute("aria-busy")}prepareVisit(t){t.a11y={announce:void 0,focus:this.rootSelector}}announceContent(t){this.swup.hooks.callSync("content:announce",t,void 0,(t=>{void 0===t.a11y.announce&&(t.a11y.announce=this.getPageAnnouncement()),t.a11y.announce&&this.announcer.announce(t.a11y.announce,this.announcementDelay)}))}focusContent(t){this.swup.hooks.callSync("content:focus",t,void 0,(t=>{t.a11y.focus&&(this.options.autofocus&&!0===function(){const t=function(){const t=document.querySelector("body [autofocus]");if(t&&!t.closest('[inert], [aria-disabled], [aria-hidden="true"]'))return t}();return!!t&&(t!==document.activeElement&&t.focus(),!0)}()||m(t.a11y.focus))}))}getPageAnnouncement(){const{headingSelector:t,announcements:e}=this.options;return function({headingSelector:t="h1",announcements:e={}}){var n,o;const i=document.documentElement.lang||"*",{href:s,url:r,pathname:a}=y.fromUrl(window.location.href),c=null!=(n=null!=(o=e[i])?o:e["*"])?n:e;if("object"!=typeof c)return;const u=document.querySelector(t);u||console.warn(`SwupA11yPlugin: No main heading (${t}) found on new page`);const l=u?.getAttribute("aria-label")||u?.textContent||document.title||p(c.url,{href:s,url:r,path:a});return p(c.visit,{title:l,href:s,url:r,path:a})}({headingSelector:t,announcements:e})}disableAnimations(t){this.options.respectReducedMotion&&window.matchMedia("(prefers-reduced-motion: reduce)").matches&&(t.animation.animate=!1,t.scroll.animate=!1)}}export{S as default};